<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Handy Garderobe</title>
<style>
  /* Basis-CSS für die Liste, kann erweitert werden */
  .erreicht { font-weight: bold; }
</style>
</head>
<body>

<h1>Handy Garderobe</h1>

<label for="nummerInput">Handynummer eingeben:</label>
<input type="text" id="nummerInput">
<button onclick="nummerHinzufuegen()">Erfassen</button>

<br><br>

<label for="zielZeit">Zielzeit in Stunden:</label>
<input type="number" id="zielZeit" value="4" min="0"> <!-- Standard auf 4 Stunden gesetzt -->
<button onclick="zielzeitSetzen()">Zielzeit setzen</button>

<h2>Liste der erfassten Nummern</h2>
<ul id="nummerListe"></ul>

<script>
  let nummernDaten = [];
let zielZeitInMillisekunden = 4 * 60 * 60 * 1000; // Standardmäßig auf 4 Stunden gesetzt

function zielzeitSetzen() {
  const stunden = document.getElementById('zielZeit').value;
  zielZeitInMillisekunden = stunden * 60 * 60 * 1000; // Umrechnung in Millisekunden
}

function nummerHinzufuegen() {
  const nummer = document.getElementById('nummerInput').value;
  const jetzt = new Date();
  const nummerInfo = {
    nummer,
    erfassungszeit: jetzt,
    timer: null,
  };

  nummerInfo.timer = setInterval(() => {
    aktualisiereNummer(nummerInfo);
  }, 1000);

  nummernDaten.push(nummerInfo);
  listeAktualisieren();
  document.getElementById('nummerInput').value = '';
}

function aktualisiereNummer(nummerInfo) {
  const aktuelleZeit = new Date();
  const differenz = zielZeitInMillisekunden - (aktuelleZeit - nummerInfo.erfassungszeit); // Berechnet die verbleibende Zeit
  const prozent = Math.min((aktuelleZeit - nummerInfo.erfassungszeit) / zielZeitInMillisekunden * 100, 100);

  if (differenz <= 0) {
    clearInterval(nummerInfo.timer);
    nummerInfo.timer = null;
  }

  // Berechnung der verbleibenden Stunden, Minuten und Sekunden
  const verbleibendeStunden = Math.floor(differenz / (1000 * 60 * 60));
  const verbleibendeMinuten = Math.floor((differenz % (1000 * 60 * 60)) / (1000 * 60));
  const verbleibendeSekunden = Math.floor((differenz % (1000 * 60)) / 1000);

  // Farbübergang von Rot zu Grün
  const rot = (100 - prozent) * 2.55;
  const gruen = prozent * 2.55;
  const farbe = `rgb(${rot}, ${gruen}, 0)`;

  const liElement = document.getElementById('nummer-' + nummerInfo.nummer);
  if (liElement) {
    liElement.style.color = farbe;

    // Aktualisieren des Textinhalts mit Countdown
    liElement.textContent = `Nummer: ${nummerInfo.nummer} | Verbleibend: ${verbleibendeStunden}h ${verbleibendeMinuten}m ${verbleibendeSekunden}s`;
    if (nummerInfo.timer === null) {
      liElement.classList.add('erreicht');
      liElement.textContent += " (Erreicht)";
    }

    // Löschen-Button sollte beibehalten werden, auch wenn der Text aktualisiert wird
    const loeschButton = document.createElement('button');
    loeschButton.textContent = 'Löschen';
    loeschButton.onclick = function() {
      clearInterval(nummerInfo.timer);
      nummernDaten = nummernDaten.filter(info => info.nummer !== nummerInfo.nummer);
      listeAktualisieren();
    };
    liElement.appendChild(loeschButton);
  }
}

function listeAktualisieren() {
  const nummerListe = document.getElementById('nummerListe');
  nummerListe.innerHTML = ''; // Liste leeren

  nummernDaten.forEach(nummerInfo => {
    const li = document.createElement('li');
    li.id = 'nummer-' + nummerInfo.nummer;
    li.textContent = `Nummer: ${nummerInfo.nummer}`; // Initialer Text, wird später im Countdown aktualisiert

    const loeschButton = document.createElement('button');
    loeschButton.textContent = 'Löschen';
    loeschButton.onclick = function() {
      clearInterval(nummerInfo.timer);
      nummernDaten = nummernDaten.filter(info => info.nummer !== nummerInfo.nummer);
      listeAktualisieren();
    };

    li.appendChild(loeschButton);
    nummerListe.appendChild(li);

    // Erstes Update direkt nach dem Erstellen des Listenelements
    aktualisiereNummer(nummerInfo);
  });
}

// Initialisiert das Ziel beim ersten Laden
zielzeitSetzen();

</script>

</body>
</html>
